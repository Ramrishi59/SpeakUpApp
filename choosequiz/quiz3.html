<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="format-detection" content="telephone=no" />
  <title>Speak Up â€” 3-Option Image Quiz</title>

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="quiz3.css">
</head>

<body>
  <header class="topbar">
    <div id="progressPill" class="pill hidden">1/3</div>
  </header>

  <main id="app">

    <!-- INTRO CARD -->
    <section id="introScreen" class="card intro-card" aria-live="polite">
      <div class="intro-image-wrap">
        <!-- Update src to your actual intro image path -->
        <img id="introImage" src="Images/1-2.webp" alt="Manku welcoming the learner" />
      </div>

      <!-- Intro audio: Manku saying the lines -->
      <audio id="introAudio" preload="auto">
        <!-- Update src to your actual audio path -->
        <source src="Audio/01_Chapter 1.mp3" type="audio/mpeg" />
      </audio>

      <div class="intro-actions">
        <button id="startBtn" class="btn primary">Letâ€™s start!</button>
        <button id="skipBtn" class="btn secondary">Skip Intro</button>
      </div>
    </section>

    <!-- MAIN CARD -->
    <section id="quizCard" class="card hidden" aria-live="polite">
      <div class="image-wrap">
        <img id="itemImage" alt="" />
      </div>

      <div id="question" class="question">
        What is shown?
      </div>

      <div class="progress-wrap" aria-label="Progress">
        <div class="progress-bar">
          <div id="progressFill" class="progress-fill"></div>
        </div>
        <div id="progressStats" class="progress-stats">0 correct so far</div>
      </div>

      <div class="choices" role="group" aria-label="Answer choices">
        <button id="c0" class="choice-btn">Choice 1</button>
        <button id="c1" class="choice-btn">Choice 2</button>
        <button id="c2" class="choice-btn">Choice 3</button>
      </div>

      <div id="feedback" class="feedback" aria-live="polite"></div>

      <div class="nav-row">
        <button id="prevBtn" class="btn secondary">Prev</button>
        <button id="nextBtn" class="btn primary">Next</button>
        <button id="resetBtn" class="btn danger">Start Over</button>
      </div>
    </section>


    <!-- RESULTS OVERLAY -->
    <section id="resultsOverlay" class="overlay hidden" role="dialog" aria-modal="true" aria-labelledby="resultsTitle">
      <div class="overlay-bg" aria-hidden="true">
        <img src="Images/activity1/score.webp" alt="">
      </div>
      <div class="overlay-card">
        <h2 id="resultsTitle">Great job!</h2>
        <p id="resultsText" class="results-text"></p>
      </div>
      <div class="nav-row overlay-nav">
        <button id="reviewBtn" class="btn secondary">Review Answers</button>
        <button id="restartBtn" class="btn primary">Go Home</button>
      </div>
    </section>
  </main>

  <!-- Confetti canvas -->
  <canvas id="confettiCanvas" class="confetti-layer"></canvas>

  <script defer src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js">
  </script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const intro = document.getElementById("introScreen");
      const quizCard = document.getElementById("quizCard");
      const startBtn = document.getElementById("startBtn");
      const skipBtn = document.getElementById("skipBtn");
      const progressPill = document.getElementById("progressPill");
      const introAudio = document.getElementById("introAudio");

      if (!intro || !quizCard || !startBtn) return;

      function goToQuiz() {
        // Safety: stop audio if still playing
        if (introAudio) {
          introAudio.pause();
          introAudio.currentTime = 0;
        }
        intro.classList.add("hidden");
        quizCard.classList.remove("hidden");
        if (progressPill) {
          progressPill.classList.remove("hidden");
        }

        // ðŸ‘‡ VERY IMPORTANT: re-render first question *after* intro,
        // so the question audio plays with a user gesture context
        if (typeof render === "function") {
          idx = 0;        // reset, just to be safe
          score = 0;
          render(idx);
        }
      }


      startBtn.addEventListener("click", () => {
        // Disable button so they don't spam it
        startBtn.disabled = true;

        if (introAudio) {
          introAudio.currentTime = 0;
          introAudio.play()
            .then(() => {
              // When audio finishes, go to quiz
              introAudio.addEventListener("ended", goToQuiz, { once: true });
            })
            .catch(() => {
              // If autoplay fails (browser block etc.), just go straight to quiz
              goToQuiz();
            });
        } else {
          goToQuiz();
        }
      });

      skipBtn?.addEventListener("click", () => {
        startBtn.disabled = true;
        skipBtn.disabled = true;
        goToQuiz();
      });
    });
  </script>

  <script src="quiz3.js" defer></script>
</body>

</html>
